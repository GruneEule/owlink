# HTTP â†’ HTTPS Weiterleitung
server {
    listen 80;
    server_name owlink.grueneeule.de;

    # Erzwingt HTTPS
    return 301 https://$host$request_uri;
}

# HTTPS-Serverblock
server {
    listen 443 ssl;
    server_name owlink.grueneeule.de;

    # SSL-Zertifikat (von Let's Encrypt)
    ssl_certificate /etc/letsencrypt/live/owlink.grueneeule.de/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/owlink.grueneeule.de/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    root /var/www/web/owlink/src;
    index index.html;

    # CGI-Pfad
    location /shortener.py {
        fastcgi_pass unix:/var/run/fcgiwrap.socket;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME /var/www/web/owlink/shortener.py;
    }

    # Weiterleitungen
    include /var/www/web/owlink/redirects.conf;

    # Optional: Sicherheits-Header
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options SAMEORIGIN;
    add_header X-XSS-Protection "1; mode=block";
}
